name: Build

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: Use Checkout
        uses: actions/checkout@v3

      - name: Setup Python 3.7
        uses: actions/setup-python@v4
        with:
          python-version: '3.7.17'

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: Install dependencies
        run: |
          cd ui
          npm ci

      - name: Build Python
        run: python -m compileall -b -q -j0 .

      - name: Build Vue
        run: |
          cd ui
          npm run build

      - name: Move Dist
        run: mv ui/dist/ dist/

      - name: Delete Vue Source
        run: rm -rf ui

      - name: Dist -> UI
        run: mv dist/ ui/

      - name: Pack TS4Script
        run: zip -r "CodeBleu - TS4 Remote REPL.ts4script" . -i '*.pyc' '*.html' '*.md' '*.css' '*.scss' '*.js' '*.json' '*.mjs' '*.ts' '*.vue' '*.jpg' '*.jpeg' '*.gif' '*.png' '*.ico' '*.ttf' '*.otf' '*.eot' '*.woff' '*.woff2' '*.browserslistrc' '*.editorconfig' -x '*node_modules*'

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: CodeBleu - TS4 Remote REPL
          path: "CodeBleu - TS4 Remote REPL.ts4script"